<!DOCTYPE html>
<html lang="en">
  <head>
    <title>buttons-are-cool server demo</title>
    <meta charset="utf-8" />
    <script type="text/javascript">
      function ready(fn) {
        if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading"){
          fn();
        } else {
          document.addEventListener('DOMContentLoaded', fn);
        }
      }

      ready(function() {
        var body = document.querySelector('body');
        var container = document.querySelector('.container');

        var loop = setInterval(function() {
          fetch('/buttons')
            .then(function(res) {
              return res.json();
            })
            .then(refreshButtons);
        }, 300);

        function refreshButtons(json) {
          container.innerHTML = '';
          if (json.testMode && !body.classList.contains('test-mode')) {
            body.classList.add('test-mode');
          }
          for (var i = 0; i < json.devices.length; i++) {
            var device = json.devices[i];
            var buttons = device.buttons;

            var title = document.createElement('h2');
            title.innerHTML = device.name;
            container.appendChild(title);

            var deviceDiv = document.createElement('div');
            deviceDiv.classList.add('device');
            container.appendChild(deviceDiv);

            Object.keys(buttons).forEach(function(buttonNum) {
              var div = document.createElement('div');
              div.innerHTML = '<div><span class="number-column">' + buttonNum + ':</span> ' + (buttons[buttonNum] ? '✅' : '⭕') + '</div>';
              deviceDiv.appendChild(div);
            });
          }
        }
      });
    </script>

    <style type="text/css">
      @import url('https://fonts.googleapis.com/css?family=Francois+One');

      /* Reset */
      html, body, h1, h2, h3, h4, h5, h6, p, ol, ul, li, dl, dt, dd, blockquote, address {
        margin: 0;
        padding: 0;
      }

      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        flex-wrap: nowrap;
        padding-top: 20px;
        font-family: "Francois One",Tahoma,Verdana,Sans;
        background-color: #F0FEF0;
      }

      .test-mode-note {
        display: none;
      }

      .live-mode-note {
        display: block;
      }

      body.test-mode {
        background-color: #FFFFF0;
      }

      body.test-mode .test-mode-note {
        display: block;
      }

      body.test-mode .live-mode-note {
        display: none;
      }

      body h2 {
        clear: both;
      }

      .container {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        margin: 0;
        padding: 10px;
        min-width: 500px;
        max-width: 800px;
        border: 1px solid black;
        margin-top: 10px;
      }

      .device {
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
        width: 100%;
        max-height: 300px;
      }

      .device h2 {
        display: block;
      }

      .device > div {
        width: 20%;
      }

      .number-column {
        display: block;
        float: left;
        min-width: 3rem;
      }

      .center {
        text-align: center;
      }

      .full-width {
        width: 100%;
      }

      .no-decorate {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="center full-width">
      <h2><a class="no-decorate" href="http://buttonsare.cool">1000 Button Project Test Page</a></h2>
      <div class='test-mode-note'>(Test Mode)</div>
      <div class='live-mode-note'>(Live Mode)</div>
    </div>
    <div class="container"></div>
  </body>
</html>
